(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,970065,e=>{"use strict";var a=e.i(843476),t=e.i(647163);function s({className:e,...s}){return(0,a.jsx)("div",{"data-slot":"card",className:(0,t.cn)("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",e),...s})}function r({className:e,...s}){return(0,a.jsx)("div",{"data-slot":"card-header",className:(0,t.cn)("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-2 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",e),...s})}function l({className:e,...s}){return(0,a.jsx)("div",{"data-slot":"card-title",className:(0,t.cn)("leading-none font-semibold",e),...s})}function n({className:e,...s}){return(0,a.jsx)("div",{"data-slot":"card-description",className:(0,t.cn)("text-muted-foreground text-sm",e),...s})}function i({className:e,...s}){return(0,a.jsx)("div",{"data-slot":"card-content",className:(0,t.cn)("px-6",e),...s})}e.s(["Card",()=>s,"CardContent",()=>i,"CardDescription",()=>n,"CardHeader",()=>r,"CardTitle",()=>l])},678745,e=>{"use strict";let a=(0,e.i(475254).default)("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);e.s(["default",()=>a])},603908,e=>{"use strict";let a=(0,e.i(475254).default)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);e.s(["default",()=>a])},107233,e=>{"use strict";var a=e.i(603908);e.s(["Plus",()=>a.default])},54089,e=>{"use strict";let a=(0,e.i(475254).default)("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);e.s(["default",()=>a])},514764,e=>{"use strict";var a=e.i(54089);e.s(["Send",()=>a.default])},786108,e=>{"use strict";let a=(0,e.i(475254).default)("EllipsisVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]);e.s(["default",()=>a])},323585,e=>{"use strict";var a=e.i(786108);e.s(["MoreVertical",()=>a.default])},643531,e=>{"use strict";var a=e.i(678745);e.s(["Check",()=>a.default])},863620,e=>{"use strict";let a=(0,e.i(475254).default)("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);e.s(["default",()=>a])},343432,e=>{"use strict";var a=e.i(863620);e.s(["Phone",()=>a.default])},618975,e=>{"use strict";let a=(0,e.i(475254).default)("Video",[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]]);e.s(["default",()=>a])},326524,587867,e=>{"use strict";var a=e.i(475254);let t=(0,a.default)("Paperclip",[["path",{d:"m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l8.57-8.57A4 4 0 1 1 18 8.84l-8.59 8.57a2 2 0 0 1-2.83-2.83l8.49-8.48",key:"1u3ebp"}]]);e.s(["default",()=>t],326524);let s=(0,a.default)("Smile",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 14s1.5 2 4 2 4-2 4-2",key:"1y1vjs"}],["line",{x1:"9",x2:"9.01",y1:"9",y2:"9",key:"yxxnd0"}],["line",{x1:"15",x2:"15.01",y1:"9",y2:"9",key:"1p4y9e"}]]);e.s(["default",()=>s],587867)},703708,e=>{"use strict";let a=(0,e.i(475254).default)("CheckCheck",[["path",{d:"M18 6 7 17l-5-5",key:"116fxf"}],["path",{d:"m22 10-7.5 7.5L13 16",key:"ke71qq"}]]);e.s(["default",()=>a])},736639,e=>{"use strict";var a=e.i(843476),t=e.i(271645),s=e.i(846932),r=e.i(555436),l=e.i(514764),n=e.i(323585),i=e.i(343432),d=e.i(618975),d=d,c=e.i(326524),c=c,o=e.i(587867),o=o,u=e.i(643531),m=e.i(703708),m=m,x=e.i(970065),h=e.i(167881),f=e.i(23750),p=e.i(63270),g=e.i(994179),v=e.i(471435),j=e.i(920755),y=e.i(647163),N=e.i(107233);function b({conversations:e,currentUserId:b}){let w=(0,j.createClient)(),[C,k]=(0,t.useState)(e),[_,S]=(0,t.useState)(null),[I,A]=(0,t.useState)([]),[M,z]=(0,t.useState)(""),[B,P]=(0,t.useState)(""),[q,T]=(0,t.useState)(!1),[D,U]=(0,t.useState)(!1),[E,L]=(0,t.useState)(""),[V,$]=(0,t.useState)([]),[K,R]=(0,t.useState)(!1),F=(0,t.useRef)(null),O=C.filter(e=>e.partner?.full_name?.toLowerCase().includes(B.toLowerCase()));(0,t.useEffect)(()=>{_&&H(_.partnerId)},[_]),(0,t.useEffect)(()=>{let e=w.channel("public:messages").on("postgres_changes",{event:"INSERT",schema:"public",table:"messages"},async e=>{let a=e.new;I.find(e=>e.id===a.id)||(_&&(a.sender_id===_.partnerId&&a.receiver_id===b||a.sender_id===b&&a.receiver_id===_.partnerId)&&A(e=>[...e,a]),k(e=>{let t=e.findIndex(e=>e.partnerId===(a.sender_id===b?a.receiver_id:a.sender_id)),s=a.sender_id===b?a.receiver_id:a.sender_id;if(-1===t)return[{partnerId:s,partner:{id:s,full_name:"Unknown",avatar_url:null},lastMessage:a,unreadCount:+(a.receiver_id===b&&!a.read)},...e];let r=[...e],l=r[t];return l.lastMessage=a,a.receiver_id!==b||a.read||(l.unreadCount=(l.unreadCount||0)+1),r.splice(t,1),[l,...r]}))}).on("postgres_changes",{event:"UPDATE",schema:"public",table:"messages"},e=>{let a=e.new;A(e=>e.map(e=>e.id===a.id?{...e,...a}:e)),k(e=>e.map(e=>e.lastMessage?.id===a.id?{...e,lastMessage:{...e.lastMessage,...a},unreadCount:a.read&&e.unreadCount?Math.max(0,e.unreadCount-1):e.unreadCount}:e))}).subscribe();return()=>{w.removeChannel(e)}},[w,b,_,I]),(0,t.useEffect)(()=>{F.current?.scrollIntoView({behavior:"smooth"})},[I]);let H=async e=>{let{data:a}=await w.from("messages").select("*").or(`and(sender_id.eq.${b},receiver_id.eq.${e}),and(sender_id.eq.${e},receiver_id.eq.${b})`).order("created_at",{ascending:!0});A(a||[]),await w.from("messages").update({read:!0}).eq("sender_id",e).eq("receiver_id",b).eq("read",!1)},Y=async()=>{if(E.trim()){R(!0);try{let e=await fetch(`/api/dashboard/chat/search?q=${encodeURIComponent(E.trim())}`),a=await e.json();$(a.users||[])}catch(e){console.error(e),$([])}R(!1)}},G=async e=>{let a={partnerId:e.id,partner:{id:e.id,full_name:e.full_name,avatar_url:e.avatar_url},lastMessage:{id:`init-${Date.now()}`,content:"",created_at:new Date().toISOString()},unreadCount:0};k(e=>[a,...e.filter(e=>e.partnerId!==a.partnerId)]),S(a),A([]),U(!1)},J=async()=>{if(!M.trim()||!_)return;T(!0);let{data:e,error:a}=await w.from("messages").insert({sender_id:b,receiver_id:_.partnerId,content:M.trim()}).select().single();!a&&e&&(A([...I,e]),z("")),T(!1)},Q=e=>{let a=new Date(e),t=Math.floor((new Date().getTime()-a.getTime())/864e5);return 0===t?a.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):1===t?"Yesterday":t<7?a.toLocaleDateString([],{weekday:"short"}):a.toLocaleDateString([],{month:"short",day:"numeric"})};return(0,a.jsxs)("div",{className:"h-[calc(100vh-8rem)] relative",children:[(0,a.jsxs)("div",{className:"flex h-full gap-4",children:[(0,a.jsxs)(x.Card,{className:"w-80 flex flex-col shrink-0",children:[(0,a.jsxs)(x.CardHeader,{className:"p-4 border-b",children:[(0,a.jsx)("h2",{className:"text-xl font-bold",children:"Messages"}),(0,a.jsxs)("div",{className:"relative mt-2",children:[(0,a.jsx)(r.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,a.jsx)(f.Input,{placeholder:"Search conversations...",className:"pl-10",value:B,onChange:e=>P(e.target.value)})]})]}),(0,a.jsx)(v.ScrollArea,{className:"flex-1",children:(0,a.jsx)("div",{className:"p-2",children:0===O.length?(0,a.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:(0,a.jsx)("p",{children:"No conversations yet"})}):O.map(e=>(0,a.jsxs)(s.motion.button,{initial:{opacity:0},animate:{opacity:1},onClick:()=>S(e),className:(0,y.cn)("w-full flex items-center gap-3 p-3 rounded-lg text-left transition-colors",_?.partnerId===e.partnerId?"bg-primary/10":"hover:bg-muted"),children:[(0,a.jsxs)(p.Avatar,{className:"h-12 w-12",children:[(0,a.jsx)(p.AvatarImage,{src:e.partner?.avatar_url||"/placeholder.svg"}),(0,a.jsx)(p.AvatarFallback,{children:e.partner?.full_name?.charAt(0)||"U"})]}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("p",{className:"font-medium truncate",children:e.partner?.full_name||"Unknown"}),(0,a.jsx)("span",{className:"text-xs text-muted-foreground",children:Q(e.lastMessage.created_at)})]}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground truncate",children:e.lastMessage.content})]}),e.unreadCount>0&&(0,a.jsx)(g.Badge,{className:"h-5 w-5 p-0 flex items-center justify-center rounded-full bg-red-500",children:e.unreadCount>9?"9+":e.unreadCount})]},e.partnerId))})})]}),D&&(0,a.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[(0,a.jsx)("div",{className:"absolute inset-0 bg-black/40",onClick:()=>U(!1)}),(0,a.jsxs)("div",{className:"bg-background rounded-lg w-full max-w-md p-4 z-10",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Start a new conversation"}),(0,a.jsx)(f.Input,{placeholder:"Search users by name",value:E,onChange:e=>L(e.target.value),onKeyDown:e=>"Enter"===e.key&&Y(),className:"mb-2"}),(0,a.jsx)("div",{className:"mb-4",children:(0,a.jsx)(h.Button,{onClick:Y,disabled:K,children:K?"Searching...":"Search"})}),(0,a.jsx)("div",{className:"max-h-60 overflow-auto space-y-2",children:0===V.length?(0,a.jsx)("div",{className:"text-sm text-muted-foreground",children:"No users found"}):V.map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between gap-2 p-2 rounded hover:bg-muted",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)(p.Avatar,{className:"h-8 w-8",children:[(0,a.jsx)(p.AvatarImage,{src:e.avatar_url||void 0}),(0,a.jsx)(p.AvatarFallback,{children:e.full_name?.charAt(0)||"U"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium",children:e.full_name}),(0,a.jsx)("div",{className:"text-xs text-muted-foreground",children:e.email||""})]})]}),(0,a.jsx)(h.Button,{variant:"ghost",size:"sm",onClick:()=>{G(e)},children:"Start"})]},e.id))})]})]}),(0,a.jsx)(x.Card,{className:"flex-1 flex flex-col",children:_?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(x.CardHeader,{className:"p-4 border-b flex flex-row items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsxs)(p.Avatar,{className:"h-10 w-10",children:[(0,a.jsx)(p.AvatarImage,{src:_.partner?.avatar_url||"/placeholder.svg"}),(0,a.jsx)(p.AvatarFallback,{children:_.partner?.full_name?.charAt(0)||"U"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium",children:_.partner?.full_name||"Unknown"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Online"})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(h.Button,{variant:"ghost",size:"icon",children:(0,a.jsx)(i.Phone,{className:"h-4 w-4"})}),(0,a.jsx)(h.Button,{variant:"ghost",size:"icon",children:(0,a.jsx)(d.default,{className:"h-4 w-4"})}),(0,a.jsx)(h.Button,{variant:"ghost",size:"icon",children:(0,a.jsx)(n.MoreVertical,{className:"h-4 w-4"})})]})]}),(0,a.jsx)(v.ScrollArea,{className:"flex-1 p-4",children:(0,a.jsxs)("div",{className:"space-y-4",children:[I.map((e,t)=>{let r=e.sender_id===b;return(0,a.jsx)(s.motion.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.02*t},className:(0,y.cn)("flex",r?"justify-end":"justify-start"),children:(0,a.jsxs)("div",{className:(0,y.cn)("max-w-[70%] rounded-2xl px-4 py-2",r?"bg-primary text-primary-foreground":"bg-muted"),children:[(0,a.jsx)("p",{children:e.content}),(0,a.jsxs)("div",{className:(0,y.cn)("flex items-center gap-1 mt-1 text-xs",r?"text-primary-foreground/70 justify-end":"text-muted-foreground"),children:[(0,a.jsx)("span",{children:Q(e.created_at)}),r&&(e.read?(0,a.jsx)(m.default,{className:"h-3 w-3"}):(0,a.jsx)(u.Check,{className:"h-3 w-3"}))]})]})},e.id)}),(0,a.jsx)("div",{ref:F})]})}),(0,a.jsx)(x.CardContent,{className:"p-4 border-t",children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(h.Button,{variant:"ghost",size:"icon",children:(0,a.jsx)(c.default,{className:"h-4 w-4"})}),(0,a.jsx)(f.Input,{placeholder:"Type a message...",value:M,onChange:e=>z(e.target.value),onKeyDown:e=>"Enter"===e.key&&!e.shiftKey&&J(),className:"flex-1"}),(0,a.jsx)(h.Button,{variant:"ghost",size:"icon",children:(0,a.jsx)(o.default,{className:"h-4 w-4"})}),(0,a.jsx)(h.Button,{onClick:J,disabled:!M.trim()||q,size:"icon",children:(0,a.jsx)(l.Send,{className:"h-4 w-4"})})]})})]}):(0,a.jsx)("div",{className:"flex-1 flex items-center justify-center text-muted-foreground",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"w-20 h-20 rounded-full bg-muted flex items-center justify-center mx-auto mb-4",children:(0,a.jsx)(l.Send,{className:"h-8 w-8"})}),(0,a.jsx)("p",{className:"text-lg font-medium",children:"Select a conversation"}),(0,a.jsx)("p",{className:"text-sm",children:"Choose a conversation from the list to start messaging"})]})})})]}),(0,a.jsx)("div",{className:"absolute right-6 bottom-6 z-40",children:(0,a.jsx)(h.Button,{onClick:()=>U(!0),className:"h-14 w-14 rounded-full p-0 flex items-center justify-center shadow-lg",children:(0,a.jsx)(N.Plus,{className:"h-6 w-6"})})}),_&&(0,a.jsxs)("div",{className:"absolute right-6 top-20 z-40 flex gap-2",children:[(0,a.jsx)(h.Button,{variant:"outline",size:"sm",onClick:()=>{console.log("Archive:",_.partnerId)},children:"Archive"}),(0,a.jsx)(h.Button,{variant:"outline",size:"sm",onClick:()=>{console.log("Pin:",_.partnerId)},children:"Pin"})]})]})}e.s(["MessagesPage",()=>b],736639)}]);