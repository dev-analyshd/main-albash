module.exports=[776625,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(346271),e=a.i(821374),f=a.i(603314),g=a.i(21034),h=a.i(53569),i=a.i(976472),j=a.i(538784),k=a.i(563588),l=a.i(452495),m=a.i(613749),n=a.i(50522),o=a.i(93518),p=a.i(856738),q=a.i(911156),r=a.i(666322),s=a.i(919256),t=a.i(340695),u=a.i(254161),v=a.i(621958),w=a.i(703130),x=a.i(807706),y=a.i(965733),z=a.i(238246),A=a.i(439288),B=a.i(50944),C=a.i(269240);async function D(a){try{let b={amount:a.amount,currency:a.currency,description:a.description,payment_method_id:a.metadata?.payment_method_id,transaction_type:a.metadata?.transaction_type,listing_id:a.metadata?.listing_id,processor:a.metadata?.processor||a.metadata?.payment_processor,crypto_chain:a.metadata?.crypto_chain||a.metadata?.chain||a.metadata?.network},c=await fetch("/api/payments/process",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(b)});if(!c.ok){let a=await c.json();return{success:!1,message:a.error||"Payment processing failed",error:a.error}}let d=await c.json();return{success:!0,transactionId:d.transaction_id,reference:d.reference,message:"Payment processed successfully",nextAction:d.next_action}}catch(a){return{success:!1,message:"Payment processing error",error:String(a)}}}async function E(){try{let a=await fetch("/api/payments/methods");if(!a.ok)throw Error("Failed to fetch payment methods");return await a.json()}catch(a){return console.error("Error fetching payment methods:",a),{success:!1,methods:[]}}}var F=a.i(917171),G=a.i(887682),H=a.i(265602),I=a.i(897020),J=a.i(596221),K=a.i(292e3);function L({open:a,onOpenChange:d,listing:e,onSuccess:f}){let g,[h,i]=(0,c.useState)("method"),[k,l]=(0,c.useState)(!1),[m,n]=(0,c.useState)(""),[o,s]=(0,c.useState)(""),[u,v]=(0,c.useState)([]),[x,z]=(0,c.useState)(""),[A,L]=(0,c.useState)(""),[M,N]=(0,c.useState)(!0),[O,P]=(0,c.useState)(!1),Q=(0,B.useRouter)(),R=(0,C.createClient)(),S=async()=>{try{N(!0);let a=await E();if(console.log("Payment methods result:",a),a.success){v(a.methods||[]);let b=a.methods?.find(a=>a.is_default);b&&s(b.id)}else console.error("Payment methods error:",a.error),n("Failed to load payment methods: "+(a.error||"Unknown error"))}catch(a){console.error("Failed to load payment methods:",a),n("Error loading payment methods")}finally{N(!1)}},T=async a=>{d(a),a&&(n(""),i("method"),await S())},U=async()=>{try{P(!0),n("");let a=await fetch("/api/payments/methods/test-add"),b=await a.json();a.ok?(await S(),b?.method?.id&&s(b.method.id)):n(b.error||"Failed to create test payment method")}catch(a){console.error("Add test method error:",a),n("Failed to create test payment method")}finally{P(!1)}},V=async()=>{l(!0),n("");try{let{data:{user:a}}=await R.auth.getUser();if(!a)return void Q.push("/auth/sign-in");let b=o||null,c=await D({method:"card",amount:e.price,currency:e.currency||"USD",description:`Purchase: ${e.title}`,metadata:{listing_id:e.id,listing_title:e.title,seller_id:e.user_id,payment_method_id:b,transaction_type:"purchase",processor:x||void 0,crypto_chain:A||void 0}});if(c.success){let{error:d}=await R.from("transactions").insert({user_id:a.id,amount:e.price,type:"purchase",status:"completed",payment_method_id:b,listing_id:e.id,description:`Purchased: ${e.title}`,external_reference:c.reference,metadata:{transaction_id:c.transactionId,processor:x||(A?`crypto_${A}`:c?.processor||"stripe")}});d||(i("confirm"),setTimeout(()=>{T(!1),f?.(c.transactionId||""),Q.push(`/dashboard/transactions?id=${c.transactionId}`)},2e3))}else n(c.error||"Payment failed. Please try again.")}catch(a){n("Payment processing error. Please try again."),console.error("Checkout error:",a)}finally{l(!1)}};return(0,b.jsx)(y.Dialog,{open:a,onOpenChange:T,children:(0,b.jsxs)(y.DialogContent,{className:"max-w-md",children:[(0,b.jsxs)(y.DialogHeader,{children:[(0,b.jsx)(y.DialogTitle,{children:"Purchase Item"}),(0,b.jsxs)(y.DialogDescription,{children:["Complete your purchase of ",e.title]})]}),"confirm"===h&&(0,b.jsxs)("div",{className:"text-center py-8 space-y-4",children:[(0,b.jsx)("div",{className:"w-12 h-12 bg-green-100 rounded-full flex items-center justify-center mx-auto",children:(0,b.jsx)(j.ShoppingCart,{className:"h-6 w-6 text-green-600"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"font-semibold text-lg",children:"Purchase Successful!"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Your order is being processed."})]})]}),"method"===h&&(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsx)(w.Card,{className:"bg-muted/50 border-0",children:(0,b.jsx)(w.CardContent,{className:"p-4",children:(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Order Total"}),(0,b.jsxs)("p",{className:"text-2xl font-bold",children:["$",e.price.toFixed(2)]}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:e.title})]})})}),m&&(0,b.jsxs)(H.Alert,{variant:"destructive",children:[(0,b.jsx)(K.AlertCircle,{className:"h-4 w-4"}),(0,b.jsx)(H.AlertDescription,{children:m})]}),M?(0,b.jsx)("div",{className:"text-center py-8",children:(0,b.jsx)(J.Loader2,{className:"h-8 w-8 animate-spin mx-auto text-muted-foreground"})}):u.length>0?(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsx)(F.Label,{children:"Select Payment Method"}),(0,b.jsx)(I.RadioGroup,{value:o,onValueChange:s,children:u.map(a=>(0,b.jsxs)("div",{className:"flex items-center space-x-2 p-3 border rounded-lg",children:[(0,b.jsx)(I.RadioGroupItem,{value:a.id,id:a.id}),(0,b.jsxs)(F.Label,{htmlFor:a.id,className:"flex items-center gap-2 flex-1 cursor-pointer",children:["card"===a.type&&(0,b.jsx)(q.CreditCard,{className:"h-4 w-4"}),"bank"===a.type&&(0,b.jsx)(r.Banknote,{className:"h-4 w-4"}),"crypto_wallet"===a.type&&(0,b.jsx)(p.Wallet,{className:"h-4 w-4"}),(0,b.jsx)("span",{children:a.label||`${a.type} (${a.last_four})`})]})]},a.id))}),(0,b.jsx)("div",{className:"mt-3",children:(0,b.jsx)(t.Button,{size:"sm",variant:"ghost",onClick:U,disabled:O,children:O?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(J.Loader2,{className:"h-4 w-4 animate-spin mr-2"}),"Adding..."]}):"Add Test Method"})}),o&&((g=u.find(a=>a.id===o))?"card"===g.type||"bank"===g.type?(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(F.Label,{children:"Processor"}),(0,b.jsxs)(G.Select,{onValueChange:a=>z(a),children:[(0,b.jsx)(G.SelectTrigger,{children:(0,b.jsx)(G.SelectValue,{children:x||"Choose processor"})}),(0,b.jsxs)(G.SelectContent,{children:[(0,b.jsx)(G.SelectItem,{value:"stripe",children:"Stripe"}),(0,b.jsx)(G.SelectItem,{value:"paystack",children:"Paystack"}),(0,b.jsx)(G.SelectItem,{value:"flutterwave",children:"Flutterwave"})]})]})]}):"crypto_wallet"===g.type?(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(F.Label,{children:"Network / Chain"}),(0,b.jsxs)(G.Select,{onValueChange:a=>L(a),children:[(0,b.jsx)(G.SelectTrigger,{children:(0,b.jsx)(G.SelectValue,{children:A||"Choose network"})}),(0,b.jsxs)(G.SelectContent,{children:[(0,b.jsx)(G.SelectItem,{value:"ethereum",children:"Ethereum"}),(0,b.jsx)(G.SelectItem,{value:"arbitrum",children:"Arbitrum"}),(0,b.jsx)(G.SelectItem,{value:"optimism",children:"Optimism"})]})]})]}):null:null)]}):(0,b.jsxs)("div",{className:"text-center py-6 space-y-3",children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"No payment methods saved"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mb-4",children:"Please add a payment method before proceeding"}),(0,b.jsxs)("div",{className:"flex gap-2 justify-center",children:[(0,b.jsx)(t.Button,{variant:"outline",onClick:()=>{T(!1),Q.push("/dashboard/wallet/methods/add")},children:"Add Payment Method"}),(0,b.jsx)(t.Button,{onClick:U,disabled:O,children:O?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(J.Loader2,{className:"h-4 w-4 animate-spin mr-2"}),"Adding..."]}):"Add Test Method"})]})]}),(0,b.jsxs)("div",{className:"flex gap-3",children:[(0,b.jsx)(t.Button,{variant:"outline",className:"flex-1",onClick:()=>T(!1),disabled:k,children:"Cancel"}),(0,b.jsx)(t.Button,{className:"flex-1 gap-2",onClick:V,disabled:k||!o||u.find(a=>a.id===o)?.type==="card"&&!x||u.find(a=>a.id===o)?.type==="crypto_wallet"&&!A,children:k?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(J.Loader2,{className:"h-4 w-4 animate-spin"}),"Processing..."]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(j.ShoppingCart,{className:"h-4 w-4"}),"Pay $",e.price.toFixed(2)]})})]})]})]})})}function M({listing:a}){let[B,C]=(0,c.useState)(0),[D,E]=(0,c.useState)(!1),[F,G]=(0,c.useState)(!1),[H,I]=(0,c.useState)(!1),J=a.images?.length>0?a.images:["/product-marketplace-listing.jpg"],K=a.profiles;return(0,b.jsxs)("div",{className:"pb-12",children:[(0,b.jsx)("div",{className:"mb-6",children:(0,b.jsx)(z.default,{href:"/marketplace",className:"text-sm text-muted-foreground hover:text-primary transition-colors",children:"â† Back to Marketplace"})}),(0,b.jsxs)("div",{className:"grid lg:grid-cols-2 gap-8",children:[(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"relative aspect-[4/3] rounded-2xl overflow-hidden bg-secondary/30",children:[(0,b.jsx)(d.motion.img,{initial:{opacity:0},animate:{opacity:1},src:J[B]||"/placeholder.svg",alt:a.title,className:"w-full h-full object-cover"},B),J.length>1&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(t.Button,{variant:"secondary",size:"icon",className:"absolute left-4 top-1/2 -translate-y-1/2 rounded-full",onClick:()=>C(a=>(a-1+J.length)%J.length),children:(0,b.jsx)(m.ChevronLeft,{className:"h-5 w-5"})}),(0,b.jsx)(t.Button,{variant:"secondary",size:"icon",className:"absolute right-4 top-1/2 -translate-y-1/2 rounded-full",onClick:()=>C(a=>(a+1)%J.length),children:(0,b.jsx)(n.ChevronRight,{className:"h-5 w-5"})})]}),(0,b.jsxs)("div",{className:"absolute top-4 left-4 flex gap-2",children:[a.is_verified&&(0,b.jsxs)(u.Badge,{className:"gap-1",children:[(0,b.jsx)(f.Shield,{className:"h-3 w-3"}),"Verified"]}),a.is_tokenized&&(0,b.jsxs)(u.Badge,{variant:"secondary",className:"gap-1",children:[(0,b.jsx)(g.Hexagon,{className:"h-3 w-3"}),"NFT"]}),a.swap_enabled&&(0,b.jsxs)(u.Badge,{variant:"secondary",className:"gap-1",children:[(0,b.jsx)(s.ArrowLeftRight,{className:"h-3 w-3"}),"Swappable"]})]})]}),J.length>1&&(0,b.jsx)("div",{className:"flex gap-2 overflow-x-auto pb-2",children:J.map((a,c)=>(0,b.jsx)("button",{onClick:()=>C(c),className:`w-20 h-20 rounded-lg overflow-hidden shrink-0 border-2 transition-colors ${B===c?"border-primary":"border-transparent"}`,children:(0,b.jsx)("img",{src:a||"/placeholder.svg",alt:"",className:"w-full h-full object-cover"})},c))})]}),(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:"flex items-start justify-between gap-4 mb-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground capitalize mb-1",children:a.listing_type}),(0,b.jsx)("h1",{className:"text-3xl font-bold",children:a.title})]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)(t.Button,{variant:"outline",size:"icon",onClick:()=>E(!D),className:"bg-transparent",children:(0,b.jsx)(i.Heart,{className:`h-5 w-5 ${D?"fill-destructive text-destructive":""}`})}),(0,b.jsx)(t.Button,{variant:"outline",size:"icon",className:"bg-transparent",children:(0,b.jsx)(h.Share2,{className:"h-5 w-5"})})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-4 mb-6",children:[(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[[1,2,3,4,5].map(a=>(0,b.jsx)(e.Star,{className:`h-5 w-5 ${a<=4?"fill-chart-4 text-chart-4":"text-muted-foreground"}`},a)),(0,b.jsx)("span",{className:"ml-2 text-sm text-muted-foreground",children:"(0 reviews)"})]}),(0,b.jsxs)("span",{className:"text-sm text-muted-foreground",children:[a.view_count||0," views"]})]}),(0,b.jsxs)("div",{className:"bg-secondary/30 rounded-xl p-6 mb-6",children:[(0,b.jsxs)("div",{className:"flex items-baseline gap-2 mb-4",children:[(0,b.jsx)("span",{className:"text-4xl font-bold text-primary",children:a.price?`$${a.price.toFixed(2)}`:"Contact for price"}),a.is_tokenized&&(0,b.jsx)("span",{className:"text-sm text-muted-foreground",children:"or crypto equivalent"})]}),(0,b.jsxs)("div",{className:"flex flex-wrap gap-2 mb-4",children:[(0,b.jsxs)(u.Badge,{variant:"outline",className:"gap-1",children:[(0,b.jsx)(q.CreditCard,{className:"h-3 w-3"}),"Card"]}),(0,b.jsxs)(u.Badge,{variant:"outline",className:"gap-1",children:[(0,b.jsx)(r.Banknote,{className:"h-3 w-3"}),"Bank Transfer"]}),a.is_tokenized&&(0,b.jsxs)(u.Badge,{variant:"outline",className:"gap-1",children:[(0,b.jsx)(p.Wallet,{className:"h-3 w-3"}),"Crypto"]})]}),(0,b.jsxs)("div",{className:"flex gap-3",children:[(0,b.jsxs)(t.Button,{className:"flex-1 gap-2",onClick:()=>I(!0),children:[(0,b.jsx)(j.ShoppingCart,{className:"h-5 w-5"}),"Buy Now"]}),a.swap_enabled&&(0,b.jsxs)(t.Button,{variant:"outline",className:"gap-2 bg-transparent",onClick:()=>G(!0),children:[(0,b.jsx)(s.ArrowLeftRight,{className:"h-5 w-5"}),"Propose Swap"]}),a.is_tokenized&&(0,b.jsxs)(t.Button,{variant:"outline",className:"gap-2 bg-transparent",children:[(0,b.jsx)(p.Wallet,{className:"h-5 w-5"}),"Make Offer"]})]}),(0,b.jsx)(y.Dialog,{open:F,onOpenChange:G,children:(0,b.jsxs)(y.DialogContent,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[(0,b.jsxs)(y.DialogHeader,{children:[(0,b.jsx)(y.DialogTitle,{children:"Propose Swap"}),(0,b.jsxs)(y.DialogDescription,{children:['Create a swap proposal for "',a.title,'"']})]}),(0,b.jsx)(A.SwapProposalForm,{targetListing:a,targetUserId:a.user_id,onClose:()=>G(!1)})]})})]}),K&&(0,b.jsx)(w.Card,{className:"mb-6",children:(0,b.jsxs)(w.CardContent,{className:"p-6",children:[(0,b.jsx)("h3",{className:"font-semibold mb-4",children:"Seller Information"}),(0,b.jsxs)("div",{className:"flex items-center gap-4 mb-4",children:[(0,b.jsxs)(x.Avatar,{className:"h-12 w-12",children:[(0,b.jsx)(x.AvatarImage,{src:K.avatar_url||void 0}),(0,b.jsx)(x.AvatarFallback,{children:K.full_name?.charAt(0)||"U"})]}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("p",{className:"font-semibold",children:K.full_name||"Anonymous"}),(0,b.jsxs)("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[K.is_verified&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(f.Shield,{className:"h-3 w-3 text-primary"}),"Verified ",K.role||"Seller"]}),(0,b.jsxs)("span",{className:"flex items-center gap-1",children:[(0,b.jsx)(o.Award,{className:"h-3 w-3 text-chart-4"}),K.reputation_score||0," pts"]})]})]})]}),(0,b.jsxs)("div",{className:"space-y-3 border-t pt-4",children:[(0,b.jsx)("h4",{className:"font-medium text-sm",children:"Contact Seller"}),(0,b.jsxs)("div",{className:"flex flex-col gap-2",children:[K.email&&(0,b.jsxs)("a",{href:`mailto:${K.email}`,className:"inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-secondary/50 hover:bg-secondary text-sm font-medium transition-colors",children:[(0,b.jsx)(k.MessageSquare,{className:"h-4 w-4"}),"Send Email"]}),(0,b.jsx)(z.default,{href:`/dashboard/messages?to=${K.id}`,children:(0,b.jsx)(t.Button,{variant:"outline",className:"w-full gap-2 bg-transparent",asChild:!0,children:(0,b.jsxs)("a",{children:[(0,b.jsx)(k.MessageSquare,{className:"h-4 w-4"}),"Send Message"]})})}),(0,b.jsx)(z.default,{href:`/profiles/${K.id}`,children:(0,b.jsx)(t.Button,{variant:"outline",className:"w-full gap-2 bg-transparent",asChild:!0,children:(0,b.jsxs)("a",{children:[(0,b.jsx)(l.ExternalLink,{className:"h-4 w-4"}),"View Profile"]})})})]})]})]})}),a.is_tokenized&&a.token_id&&(0,b.jsx)(w.Card,{className:"mb-6",children:(0,b.jsxs)(w.CardContent,{className:"p-4",children:[(0,b.jsxs)("h3",{className:"font-semibold mb-3 flex items-center gap-2",children:[(0,b.jsx)(g.Hexagon,{className:"h-5 w-5 text-primary"}),"Token Information"]}),(0,b.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Token ID"}),(0,b.jsx)("span",{className:"font-mono",children:a.token_id})]}),a.contract_address&&(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Contract"}),(0,b.jsxs)("a",{href:"#",className:"text-primary hover:underline flex items-center gap-1",children:[a.contract_address.slice(0,10),"...",(0,b.jsx)(l.ExternalLink,{className:"h-3 w-3"})]})]}),(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Chain"}),(0,b.jsx)("span",{children:"Ethereum"})]})]})]})})]})]}),(0,b.jsxs)(v.Tabs,{defaultValue:"description",className:"mt-8",children:[(0,b.jsxs)(v.TabsList,{children:[(0,b.jsx)(v.TabsTrigger,{value:"description",children:"Description"}),(0,b.jsx)(v.TabsTrigger,{value:"reviews",children:"Reviews"}),(0,b.jsx)(v.TabsTrigger,{value:"details",children:"Details"})]}),(0,b.jsx)(v.TabsContent,{value:"description",className:"mt-6",children:(0,b.jsx)(w.Card,{children:(0,b.jsx)(w.CardContent,{className:"p-6",children:(0,b.jsx)("div",{className:"prose prose-sm max-w-none dark:prose-invert",children:(0,b.jsx)("p",{className:"whitespace-pre-line",children:a.description})})})})}),(0,b.jsx)(v.TabsContent,{value:"reviews",className:"mt-6",children:(0,b.jsx)(w.Card,{children:(0,b.jsx)(w.CardContent,{className:"p-6",children:(0,b.jsx)("p",{className:"text-muted-foreground text-center py-8",children:"No reviews yet. Be the first to review!"})})})}),(0,b.jsx)(v.TabsContent,{value:"details",className:"mt-6",children:(0,b.jsx)(w.Card,{children:(0,b.jsx)(w.CardContent,{className:"p-6",children:(0,b.jsxs)("div",{className:"grid sm:grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Category"}),(0,b.jsx)("p",{className:"font-medium capitalize",children:a.categories?.name||"Uncategorized"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Type"}),(0,b.jsx)("p",{className:"font-medium capitalize",children:a.listing_type})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Listed"}),(0,b.jsx)("p",{className:"font-medium",children:new Date(a.created_at).toLocaleDateString()})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Views"}),(0,b.jsx)("p",{className:"font-medium",children:a.view_count||0})]})]})})})})]}),(0,b.jsx)(L,{open:H,onOpenChange:I,listing:{id:a.id,title:a.title,price:a.price||0,currency:"USD",user_id:a.user_id},onSuccess:a=>{console.log("Purchase successful:",a)}})]})}a.s(["ListingDetail",()=>M],776625)}];

//# sourceMappingURL=components_marketplace_listing-detail_tsx_ec69f121._.js.map