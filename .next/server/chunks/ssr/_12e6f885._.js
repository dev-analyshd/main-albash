module.exports=[703130,a=>{"use strict";var b=a.i(187924),c=a.i(497895);function d({className:a,...d}){return(0,b.jsx)("div",{"data-slot":"card",className:(0,c.cn)("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",a),...d})}function e({className:a,...d}){return(0,b.jsx)("div",{"data-slot":"card-header",className:(0,c.cn)("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-2 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",a),...d})}function f({className:a,...d}){return(0,b.jsx)("div",{"data-slot":"card-title",className:(0,c.cn)("leading-none font-semibold",a),...d})}function g({className:a,...d}){return(0,b.jsx)("div",{"data-slot":"card-description",className:(0,c.cn)("text-muted-foreground text-sm",a),...d})}function h({className:a,...d}){return(0,b.jsx)("div",{"data-slot":"card-content",className:(0,c.cn)("px-6",a),...d})}a.s(["Card",()=>d,"CardContent",()=>h,"CardDescription",()=>g,"CardHeader",()=>e,"CardTitle",()=>f])},234157,a=>{"use strict";let b=(0,a.i(170106).default)("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);a.s(["default",()=>b])},516868,a=>{"use strict";let b=(0,a.i(170106).default)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);a.s(["default",()=>b])},915618,a=>{"use strict";var b=a.i(516868);a.s(["Plus",()=>b.default])},601304,a=>{"use strict";let b=(0,a.i(170106).default)("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);a.s(["default",()=>b])},692759,a=>{"use strict";var b=a.i(601304);a.s(["Send",()=>b.default])},84218,a=>{"use strict";let b=(0,a.i(170106).default)("EllipsisVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]);a.s(["default",()=>b])},879360,a=>{"use strict";var b=a.i(84218);a.s(["MoreVertical",()=>b.default])},533441,a=>{"use strict";var b=a.i(234157);a.s(["Check",()=>b.default])},216688,a=>{"use strict";let b=(0,a.i(170106).default)("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);a.s(["default",()=>b])},963519,a=>{"use strict";var b=a.i(216688);a.s(["Phone",()=>b.default])},835134,a=>{"use strict";let b=(0,a.i(170106).default)("Video",[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]]);a.s(["default",()=>b])},82826,535703,a=>{"use strict";var b=a.i(170106);let c=(0,b.default)("Paperclip",[["path",{d:"m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l8.57-8.57A4 4 0 1 1 18 8.84l-8.59 8.57a2 2 0 0 1-2.83-2.83l8.49-8.48",key:"1u3ebp"}]]);a.s(["default",()=>c],82826);let d=(0,b.default)("Smile",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 14s1.5 2 4 2 4-2 4-2",key:"1y1vjs"}],["line",{x1:"9",x2:"9.01",y1:"9",y2:"9",key:"yxxnd0"}],["line",{x1:"15",x2:"15.01",y1:"9",y2:"9",key:"1p4y9e"}]]);a.s(["default",()=>d],535703)},309581,a=>{"use strict";let b=(0,a.i(170106).default)("CheckCheck",[["path",{d:"M18 6 7 17l-5-5",key:"116fxf"}],["path",{d:"m22 10-7.5 7.5L13 16",key:"ke71qq"}]]);a.s(["default",()=>b])},527260,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(346271),e=a.i(587532),f=a.i(692759),g=a.i(879360),h=a.i(963519),i=a.i(835134),i=i,j=a.i(82826),j=j,k=a.i(535703),k=k,l=a.i(533441),m=a.i(309581),m=m,n=a.i(703130),o=a.i(340695),p=a.i(205522),q=a.i(807706),r=a.i(254161),s=a.i(46470),t=a.i(269240),u=a.i(497895),v=a.i(915618);function w({conversations:a,currentUserId:w}){let x=(0,t.createClient)(),[y,z]=(0,c.useState)(a),[A,B]=(0,c.useState)(null),[C,D]=(0,c.useState)([]),[E,F]=(0,c.useState)(""),[G,H]=(0,c.useState)(""),[I,J]=(0,c.useState)(!1),[K,L]=(0,c.useState)(!1),[M,N]=(0,c.useState)(""),[O,P]=(0,c.useState)([]),[Q,R]=(0,c.useState)(!1),S=(0,c.useRef)(null),T=y.filter(a=>a.partner?.full_name?.toLowerCase().includes(G.toLowerCase()));(0,c.useEffect)(()=>{A&&U(A.partnerId)},[A]),(0,c.useEffect)(()=>{let a=x.channel("public:messages").on("postgres_changes",{event:"INSERT",schema:"public",table:"messages"},async a=>{let b=a.new;C.find(a=>a.id===b.id)||(A&&(b.sender_id===A.partnerId&&b.receiver_id===w||b.sender_id===w&&b.receiver_id===A.partnerId)&&D(a=>[...a,b]),z(a=>{let c=a.findIndex(a=>a.partnerId===(b.sender_id===w?b.receiver_id:b.sender_id)),d=b.sender_id===w?b.receiver_id:b.sender_id;if(-1===c)return[{partnerId:d,partner:{id:d,full_name:"Unknown",avatar_url:null},lastMessage:b,unreadCount:+(b.receiver_id===w&&!b.read)},...a];let e=[...a],f=e[c];return f.lastMessage=b,b.receiver_id!==w||b.read||(f.unreadCount=(f.unreadCount||0)+1),e.splice(c,1),[f,...e]}))}).on("postgres_changes",{event:"UPDATE",schema:"public",table:"messages"},a=>{let b=a.new;D(a=>a.map(a=>a.id===b.id?{...a,...b}:a)),z(a=>a.map(a=>a.lastMessage?.id===b.id?{...a,lastMessage:{...a.lastMessage,...b},unreadCount:b.read&&a.unreadCount?Math.max(0,a.unreadCount-1):a.unreadCount}:a))}).subscribe();return()=>{x.removeChannel(a)}},[x,w,A,C]),(0,c.useEffect)(()=>{S.current?.scrollIntoView({behavior:"smooth"})},[C]);let U=async a=>{let{data:b}=await x.from("messages").select("*").or(`and(sender_id.eq.${w},receiver_id.eq.${a}),and(sender_id.eq.${a},receiver_id.eq.${w})`).order("created_at",{ascending:!0});D(b||[]),await x.from("messages").update({read:!0}).eq("sender_id",a).eq("receiver_id",w).eq("read",!1)},V=async()=>{if(M.trim()){R(!0);try{let a=await fetch(`/api/dashboard/chat/search?q=${encodeURIComponent(M.trim())}`),b=await a.json();P(b.users||[])}catch(a){console.error(a),P([])}R(!1)}},W=async a=>{let b={partnerId:a.id,partner:{id:a.id,full_name:a.full_name,avatar_url:a.avatar_url},lastMessage:{id:`init-${Date.now()}`,content:"",created_at:new Date().toISOString()},unreadCount:0};z(a=>[b,...a.filter(a=>a.partnerId!==b.partnerId)]),B(b),D([]),L(!1)},X=async()=>{if(!E.trim()||!A)return;J(!0);let{data:a,error:b}=await x.from("messages").insert({sender_id:w,receiver_id:A.partnerId,content:E.trim()}).select().single();!b&&a&&(D([...C,a]),F("")),J(!1)},Y=a=>{let b=new Date(a),c=Math.floor((new Date().getTime()-b.getTime())/864e5);return 0===c?b.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):1===c?"Yesterday":c<7?b.toLocaleDateString([],{weekday:"short"}):b.toLocaleDateString([],{month:"short",day:"numeric"})};return(0,b.jsxs)("div",{className:"h-[calc(100vh-8rem)] relative",children:[(0,b.jsxs)("div",{className:"flex h-full gap-4",children:[(0,b.jsxs)(n.Card,{className:"w-80 flex flex-col shrink-0",children:[(0,b.jsxs)(n.CardHeader,{className:"p-4 border-b",children:[(0,b.jsx)("h2",{className:"text-xl font-bold",children:"Messages"}),(0,b.jsxs)("div",{className:"relative mt-2",children:[(0,b.jsx)(e.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,b.jsx)(p.Input,{placeholder:"Search conversations...",className:"pl-10",value:G,onChange:a=>H(a.target.value)})]})]}),(0,b.jsx)(s.ScrollArea,{className:"flex-1",children:(0,b.jsx)("div",{className:"p-2",children:0===T.length?(0,b.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:(0,b.jsx)("p",{children:"No conversations yet"})}):T.map(a=>(0,b.jsxs)(d.motion.button,{initial:{opacity:0},animate:{opacity:1},onClick:()=>B(a),className:(0,u.cn)("w-full flex items-center gap-3 p-3 rounded-lg text-left transition-colors",A?.partnerId===a.partnerId?"bg-primary/10":"hover:bg-muted"),children:[(0,b.jsxs)(q.Avatar,{className:"h-12 w-12",children:[(0,b.jsx)(q.AvatarImage,{src:a.partner?.avatar_url||"/placeholder.svg"}),(0,b.jsx)(q.AvatarFallback,{children:a.partner?.full_name?.charAt(0)||"U"})]}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("p",{className:"font-medium truncate",children:a.partner?.full_name||"Unknown"}),(0,b.jsx)("span",{className:"text-xs text-muted-foreground",children:Y(a.lastMessage.created_at)})]}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground truncate",children:a.lastMessage.content})]}),a.unreadCount>0&&(0,b.jsx)(r.Badge,{className:"h-5 w-5 p-0 flex items-center justify-center rounded-full bg-red-500",children:a.unreadCount>9?"9+":a.unreadCount})]},a.partnerId))})})]}),K&&(0,b.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[(0,b.jsx)("div",{className:"absolute inset-0 bg-black/40",onClick:()=>L(!1)}),(0,b.jsxs)("div",{className:"bg-background rounded-lg w-full max-w-md p-4 z-10",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Start a new conversation"}),(0,b.jsx)(p.Input,{placeholder:"Search users by name",value:M,onChange:a=>N(a.target.value),onKeyDown:a=>"Enter"===a.key&&V(),className:"mb-2"}),(0,b.jsx)("div",{className:"mb-4",children:(0,b.jsx)(o.Button,{onClick:V,disabled:Q,children:Q?"Searching...":"Search"})}),(0,b.jsx)("div",{className:"max-h-60 overflow-auto space-y-2",children:0===O.length?(0,b.jsx)("div",{className:"text-sm text-muted-foreground",children:"No users found"}):O.map(a=>(0,b.jsxs)("div",{className:"flex items-center justify-between gap-2 p-2 rounded hover:bg-muted",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsxs)(q.Avatar,{className:"h-8 w-8",children:[(0,b.jsx)(q.AvatarImage,{src:a.avatar_url||void 0}),(0,b.jsx)(q.AvatarFallback,{children:a.full_name?.charAt(0)||"U"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"font-medium",children:a.full_name}),(0,b.jsx)("div",{className:"text-xs text-muted-foreground",children:a.email||""})]})]}),(0,b.jsx)(o.Button,{variant:"ghost",size:"sm",onClick:()=>{W(a)},children:"Start"})]},a.id))})]})]}),(0,b.jsx)(n.Card,{className:"flex-1 flex flex-col",children:A?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)(n.CardHeader,{className:"p-4 border-b flex flex-row items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsxs)(q.Avatar,{className:"h-10 w-10",children:[(0,b.jsx)(q.AvatarImage,{src:A.partner?.avatar_url||"/placeholder.svg"}),(0,b.jsx)(q.AvatarFallback,{children:A.partner?.full_name?.charAt(0)||"U"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-medium",children:A.partner?.full_name||"Unknown"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Online"})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(o.Button,{variant:"ghost",size:"icon",children:(0,b.jsx)(h.Phone,{className:"h-4 w-4"})}),(0,b.jsx)(o.Button,{variant:"ghost",size:"icon",children:(0,b.jsx)(i.default,{className:"h-4 w-4"})}),(0,b.jsx)(o.Button,{variant:"ghost",size:"icon",children:(0,b.jsx)(g.MoreVertical,{className:"h-4 w-4"})})]})]}),(0,b.jsx)(s.ScrollArea,{className:"flex-1 p-4",children:(0,b.jsxs)("div",{className:"space-y-4",children:[C.map((a,c)=>{let e=a.sender_id===w;return(0,b.jsx)(d.motion.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.02*c},className:(0,u.cn)("flex",e?"justify-end":"justify-start"),children:(0,b.jsxs)("div",{className:(0,u.cn)("max-w-[70%] rounded-2xl px-4 py-2",e?"bg-primary text-primary-foreground":"bg-muted"),children:[(0,b.jsx)("p",{children:a.content}),(0,b.jsxs)("div",{className:(0,u.cn)("flex items-center gap-1 mt-1 text-xs",e?"text-primary-foreground/70 justify-end":"text-muted-foreground"),children:[(0,b.jsx)("span",{children:Y(a.created_at)}),e&&(a.read?(0,b.jsx)(m.default,{className:"h-3 w-3"}):(0,b.jsx)(l.Check,{className:"h-3 w-3"}))]})]})},a.id)}),(0,b.jsx)("div",{ref:S})]})}),(0,b.jsx)(n.CardContent,{className:"p-4 border-t",children:(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(o.Button,{variant:"ghost",size:"icon",children:(0,b.jsx)(j.default,{className:"h-4 w-4"})}),(0,b.jsx)(p.Input,{placeholder:"Type a message...",value:E,onChange:a=>F(a.target.value),onKeyDown:a=>"Enter"===a.key&&!a.shiftKey&&X(),className:"flex-1"}),(0,b.jsx)(o.Button,{variant:"ghost",size:"icon",children:(0,b.jsx)(k.default,{className:"h-4 w-4"})}),(0,b.jsx)(o.Button,{onClick:X,disabled:!E.trim()||I,size:"icon",children:(0,b.jsx)(f.Send,{className:"h-4 w-4"})})]})})]}):(0,b.jsx)("div",{className:"flex-1 flex items-center justify-center text-muted-foreground",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:"w-20 h-20 rounded-full bg-muted flex items-center justify-center mx-auto mb-4",children:(0,b.jsx)(f.Send,{className:"h-8 w-8"})}),(0,b.jsx)("p",{className:"text-lg font-medium",children:"Select a conversation"}),(0,b.jsx)("p",{className:"text-sm",children:"Choose a conversation from the list to start messaging"})]})})})]}),(0,b.jsx)("div",{className:"absolute right-6 bottom-6 z-40",children:(0,b.jsx)(o.Button,{onClick:()=>L(!0),className:"h-14 w-14 rounded-full p-0 flex items-center justify-center shadow-lg",children:(0,b.jsx)(v.Plus,{className:"h-6 w-6"})})}),A&&(0,b.jsxs)("div",{className:"absolute right-6 top-20 z-40 flex gap-2",children:[(0,b.jsx)(o.Button,{variant:"outline",size:"sm",onClick:()=>{console.log("Archive:",A.partnerId)},children:"Archive"}),(0,b.jsx)(o.Button,{variant:"outline",size:"sm",onClick:()=>{console.log("Pin:",A.partnerId)},children:"Pin"})]})]})}a.s(["MessagesPage",()=>w],527260)}];

//# sourceMappingURL=_12e6f885._.js.map